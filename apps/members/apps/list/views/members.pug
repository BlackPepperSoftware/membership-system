extends ../../../../../src/views/base.pug

block prepend title
	- title = app.title
	-
block append js
	script( type="text/javascript" ).
		jQuery(document).ready(function($) {
			$("tr[data-href]").click(function() {
				window.document.location = $(this).data("href");
			});
		});
		jQuery( document ).ready( function () {
			jQuery.extend( jQuery.expr[":"], {
				"containsIN": function(elem, i, match, array ) {
				return ( elem.textContent || elem.innerText || "" ).toLowerCase().indexOf( ( match[3] || "" ).toLowerCase() ) >= 0;
				}
			} );

			jQuery( "#filter" ).on( "input", function () {
				// split the current value of searchInput
				var data = this.value.split( " " );

				// create a jquery object of the rows
				var jo = $( "tbody" ).find( "tr" );

				if ( this.value == "" ) {
					jo.show();
					return;
				}

				// hide all the rows
				jo.hide();

				// Recusively filter the jquery object to get results.
				jo.filter( function ( i, v ) {
					var $t = jQuery( this );
					for ( var d = 0; d < data.length; ++d ) {
						if ( $t.is( ":containsIN('" + data[d] + "')" ) ) {
							return true;
						}
					}
					return false;
				}).show();
			});
		});

block contents
	input( placeholder="Filter", style="max-width: 200px; display: inline;" )#filter.form-control
	| &nbsp;
	.dropdown( style="display: inline;" )
		button( type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" )#filter.btn.btn-default.dropdown-toggle
			span.caret
			|  Filter by permissions
		ul.dropdown-menu( aria-labelledby="filter" )
			li: a( href="/members" ) Show all
			li( role="separator" ).divider
			each permission, p in permissions
				li: a( href="/members/list?permission={{ permission.slug }}" ) #{ permission.name }
	hr
	p Members: #{ members.length }
	hr
	table.table.table-striped.table-hover.table-condensed
		thead
			tr
				th Gravatar
				th First name
				th Last name
				th Joined
				th Emergency Contact
		tbody
			each member, m in members
				tr( title="View Member", data-href="/members/list/" + member.uuid, style="cursor: pointer;" )
					td
						img( style="border-radius: 100%", src=member.gravatar + "?s=75&d=mm&r=g" )
					td #{ member.firstname }
					td #{ member.lastname }
					td #{ moment( member.joined ).format( 'DD/MM/YYYY' ) }
					td
						if member.emergency_contact.telephone
							| Yes
						else
							| No
