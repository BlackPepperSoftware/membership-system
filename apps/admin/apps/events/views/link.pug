extends ../../../../../src/views/base.pug

block prepend title
	- title = 'Link tag #' + tag + ' to user'
	- heading = title
	- activeApp = 'admin'

	block append js
		script( type="text/javascript" ).
			jQuery(document).ready(function($) {
				$("tr[data-href]").click(function() {
					window.document.location = $(this).data("href");
				});
			});
			jQuery( document ).ready( function () {
				jQuery.extend( jQuery.expr[":"], {
					"containsIN": function(elem, i, match, array ) {
					return ( elem.textContent || elem.innerText || "" ).toLowerCase().indexOf( ( match[3] || "" ).toLowerCase() ) >= 0;
					}
				} );

				jQuery( "#filter" ).on( "input", function () {
					// split the current value of searchInput
					var data = this.value.split( " " );

					// create a jquery object of the rows
					var jo = $( "tbody" ).find( "tr" );

					if ( this.value == "" ) {
						jo.show();
						return;
					}

					// hide all the rows
					jo.hide();

					// Recusively filter the jquery object to get results.
					jo.filter( function ( i, v ) {
						var $t = jQuery( this );
						for ( var d = 0; d < data.length; ++d ) {
							if ( $t.is( ":containsIN('" + data[d] + "')" ) ) {
								return true;
							}
						}
						return false;
					}).show();
				});
			});

block contents
	input( placeholder="Filter", style="max-width: 200px" )#filter.form-control
	hr
	table.table.table-striped.table-condensed
		colgroup
			col( style="width: 5%" )
			col( span="2", style="width: 10%" )
			col( style="width: 15%" )
			col( span="6", style="width: 10%;" )
		thead
			tr
				th Link
				th First name
				th Last name
				th Email
		tbody
			each member, m in members
				tr
					td: a.btn.btn-xs( href="/admin/events/link/" + event._id + "/" + member.uuid, class=( ! member.tag.id ? 'btn-primary' : 'btn-default' ) )
						| #{ ! member.tag.id ? 'Link' : 'Replace' }
					td #{ member.firstname }
					td #{ member.lastname }
					td #{ member.email }
